@use '@design/core.scss';
@use '@design/button.scss';
@use '@design/theme.scss';
@use '@design/position.scss';
@use '@design/tokens.scss';
@use '@design/hybrid-theme.scss' as hybrid;

// ============================================================================
// DRAWER COMPONENT
// ============================================================================

.drawer {
  // 1. Variables (must come first for Sass 1.92.0+)
  $min-width: var(--min-width, 300px);
  $min-height: var(--min-height, 50vh);

  // 2. Extends
  @extend %col;

  // 3. Properties (before nested rules)
  box-shadow: hybrid.$shadow-strong;
  height: $min-height;
  min-width: $min-width;
  opacity: 0; // GPU-optimized (was visibility: hidden)
  outline: 0;
  overflow-y: auto;
  position: absolute;

  // 4. Nested selectors
  &.dark {
    background-color: theme.$dark-control-bg;
    box-shadow: hybrid.$shadow-strong;
  }

  &:not(.dark) {
    background-color: theme.$white;
  }

  &.visible {
    opacity: 1; // GPU-optimized
  }

  &.exiting {
    &.left {
      @include hybrid.exit-slide-left(hybrid.$animation-duration-secondary);
    }

    &.right {
      @include hybrid.exit-slide-right(hybrid.$animation-duration-secondary);
    }

    &.top {
      @include hybrid.exit-slide-up(hybrid.$animation-duration-secondary);
    }

    &.bottom {
      @include hybrid.exit-slide-down(hybrid.$animation-duration-secondary);
    }
  }

  &.isLoading {
    @include hybrid.state-loading();
  }

  &.isError {
    @include hybrid.state-error();
  }

  &:focus-visible {
    @include hybrid.focus-outline(theme.$primary);
  }

  // Position-specific styles
  &.left {
    @include position.position-abs('center left');
    border-top-right-radius: hybrid.$radius-md;
    border-bottom-right-radius: hybrid.$radius-md;
  }

  &.right {
    @include position.position-abs('center right');
    border-top-left-radius: hybrid.$radius-md;
    border-bottom-left-radius: hybrid.$radius-md;
  }

  &.top {
    @include position.position-abs('top center');
    border-bottom-left-radius: hybrid.$radius-md;
    border-bottom-right-radius: hybrid.$radius-md;
    min-width: 100%;
  }

  &.bottom {
    @include position.position-abs('bottom center');
    border-top-left-radius: hybrid.$radius-md;
    border-top-right-radius: hybrid.$radius-md;
    min-width: 100%;
  }

  // Entrance animations
  &.slide_left_enter {
    @include hybrid.slide-in(left, hybrid.$animation-duration-critical);
  }

  &.slide_right_enter {
    @include hybrid.slide-in(right, hybrid.$animation-duration-critical);
  }

  &.slide_top_enter {
    @include hybrid.slide-in(down, hybrid.$animation-duration-critical);
  }

  &.slide_bottom_enter {
    @include hybrid.slide-in(up, hybrid.$animation-duration-critical);
  }

  // Exit animations (legacy support)
  &.slide_left_exit,
  &.slide_right_exit,
  &.slide_top_exit,
  &.slide_bottom_exit {
    // Use .exiting class instead for Hybrid Theme exit animations
    opacity: 0;
  }
}

// ============================================================================
// CLOSE BUTTON WRAPPER
// ============================================================================

.close-btn-wrapper {
  @include position.position-abs('top right');
  right: tokens.$space-2;
  top: tokens.$space-2;

  // Close button feedback
  button {
    @include hybrid.smooth-transition(transform, box-shadow);

    @include hybrid.hover-feedback() {
      transform: rotate(90deg);
      box-shadow: hybrid.$shadow-medium;
    }

    @include hybrid.touch-feedback() {
      transform: scale(0.95);
    }
  }
}

// ============================================================================
// ACCESSIBILITY: REDUCED MOTION
// ============================================================================

@media (prefers-reduced-motion: reduce) {
  .drawer {
    animation: none !important;
  }
}
