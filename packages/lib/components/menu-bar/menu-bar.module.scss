@use '@design/core.scss';
@use '@design/list.scss';
@use '@design/theme.scss';
@use '@design/tokens.scss';
@use '@design/font.scss';
@use '@design/icon.scss';
@use '@design/animate.scss';

// Configuration constants
$sizes: (sm, md, lg);
$min-item-width: 60px;
$item-padding-vertical: tokens.$space-3;
$item-padding-horizontal: tokens.$space-1;
$icon-margin: tokens.$space-2;
$divider-width: 1px;
$divider-height: 75%;
$border-radius-hover: 2px;
$focus-outline-width: 2px;
$focus-outline-offset: -2px;
$disabled-opacity: 0.5;
$animation-duration: 0.2s;

.wrapper {
  @extend %border-radius;
  @extend %list-horizontal-left;
  width: 100%;

  &.dark {
    background: theme.$chinese-black;
  }

  &:not(.dark) {
    background: rgba(theme.$secondary-rgb, 0.25);
  }

  &.right_aligned {
    direction: rtl;
  }
}

.item {
  @extend %center;
  cursor: pointer;
  min-width: $min-item-width;
  padding: $item-padding-vertical $item-padding-horizontal;
  position: relative;
  transition: background-color 0.15s ease, color 0.15s ease;

  &.dark {
    color: theme.$white;
  }

  &:not(.dark) {
    color: theme.$black;
  }

  // Divider between items
  &:not(:last-child)::after {
    content: '';
    display: block;
    height: $divider-height;
    position: absolute;
    width: $divider-width;
  }

  // Disabled state
  &.disabled {
    cursor: not-allowed;
    opacity: $disabled-opacity;

    &:hover {
      background-color: transparent;
    }
  }
}

// Dark mode item styling
.item.dark:not(.disabled) {
  &:not(:last-child):not(.rtl)::after {
    background: theme.$dark-control-bg;
    right: -1px;
  }

  &:not(:last-child).rtl::after {
    background: theme.$dark-control-bg;
    left: -1px;
  }

  &:hover {
    background: theme.$primary;
    border-radius: $border-radius-hover;
  }
}

// Light mode item styling
.item:not(.dark):not(.disabled) {
  &:not(:last-child):not(.rtl) {
    border-right: $divider-width solid rgba(theme.$secondary-rgb, 0.5);
  }

  &:not(:last-child).rtl {
    border-left: $divider-width solid rgba(theme.$secondary-rgb, 0.5);
  }

  &:hover {
    background-color: theme.$secondary;
    border-radius: $border-radius-hover;
  }
}

// Active state
.item.active:not(.disabled) {
  color: theme.$white;

  &.dark {
    background-color: theme.$primary;
  }

  &:not(.dark) {
    background-color: theme.$primary;
    color: theme.$white;
  }
}

// Focus indicators for keyboard navigation
.item:focus-visible:not(.disabled) {
  outline: $focus-outline-width solid theme.$primary;
  outline-offset: $focus-outline-offset;
}

// Respect user motion preferences
@media (prefers-reduced-motion: reduce) {
  .chevron_icon.rotate,
  .chevron_icon.rotate_reverse {
    animation: none !important;
  }
}

// Menu item name styling
.name {
  @extend %center;

  &.rtl {
    margin-right: $icon-margin;
  }

  &:not(.rtl) {
    margin-left: $icon-margin;
  }

  @each $size in $sizes {
    &.#{$size} {
      @extend %text-#{$size};
    }
  }
}

// Menu item icon styling
.icon {
  margin-left: $icon-margin;

  @each $size in $sizes {
    &.#{$size} {
      @extend %icon-#{$size};
    }
  }
}

// Chevron icon for dropdown indicator
.chevron_icon {
  $animation-settings: (
    from: (
      transform: rotate(0deg),
    ),
    to: (
      transform: rotate(180deg),
    ),
  );

  &.rtl {
    margin-right: auto;
  }

  &:not(.rtl) {
    margin-left: auto;
  }

  // Animation mixins that generate @keyframes (nested rules) come after properties
  @include animate.set-settings($animation-duration);
  @include animate.set-keyframes(rotate, $animation-settings);
  @include animate.set-keyframes(rotate-reverse, $animation-settings, true);

  @each $size in $sizes {
    &.#{$size} {
      @extend %icon-#{$size};
    }
  }

  &.rotate {
    animation-name: rotate;
    transform: rotate(180deg);
  }

  &.rotate_reverse {
    animation-name: rotate-reverse;
    transform: rotate(0deg);
  }
}
