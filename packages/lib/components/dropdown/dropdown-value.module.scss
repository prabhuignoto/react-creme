@use '@design/theme.scss';
@use '@design/tokens.scss';
@use '@design/core.scss';
@use '@design/animate.scss';
@use '@design/position.scss';
@use '@design/font.scss';
@use '@design/effects.scss';
@use 'sass:map';

$sizes: (sm, md, lg);

.container {
  @extend %border-radius;
  align-items: center;
  cursor: pointer;
  font-size: 14px;
  min-height: 40px;
  padding: tokens.$space-2 tokens.$space-1;
  transition: border-color 0.2s ease-in, box-shadow 0.2s ease-in;
  width: 100%;

  &:not(.dark):not(.open) {
    @extend %shadow-inset-small;
  }

  &.dark {
    @extend %shadow-inset;
    background-color: theme.$chinese-black;
    color: theme.$white;
  }

  &:not(.dark) {
    @extend %border;

    // Add hover state for better UX
    &:not(.disabled):hover {
      border-color: rgba(theme.$primary-rgb, 0.4);
      box-shadow: 0 0 0 1px rgba(theme.$primary-rgb, 0.1);
    }

    // Enhanced focus-visible for modern browsers
    &:focus-visible {
      outline: 2px solid rgba(theme.$primary-rgb, 0.6);
      outline-offset: 2px;
    }
  }

  &.open {
    border-color: rgba(theme.$primary-rgb, 0.5);
    box-shadow: 0 0 0 2px rgba(theme.$primary-rgb, 0.15);
  }

  &.disabled {
    @extend %disabled;
  }

  &:not(.multi) {
    @extend %center;
    min-height: 40px;
  }

  &.rtl {
    direction: rtl;
  }

  &:not(.with_clear) {
    display: grid;
    gap: tokens.$space-2;
    grid-template-columns: 1fr auto;
  }

  &.with_clear {
    display: grid;
    gap: tokens.$space-2;
    grid-template-columns: 1fr auto auto;
  }
}

.multi {
  align-items: flex-start;
  min-height: 48px;
  padding: tokens.$space-2;
}

.container:not(.rtl) {
  .value {
    padding-left: tokens.$space-3;
  }
}

.container.rtl {
  .value {
    padding-right: tokens.$space-3;
  }

  .chevron_icon {
    margin-left: tokens.$space-1;
  }
}

.value {
  @extend %text-no-wrap;
  align-self: center;
  line-height: 1.5;
  padding: tokens.$space-1 0;

  &.rtl {
    text-align: right;
  }
}

.chevron_icon {
  @include effects.halo();
  align-self: center;
  color: var(--chevron-icon-color, theme.$primary);
  flex-shrink: 0;
  justify-self: center;
  order: 4;
  position: relative;
  transition: transform 0.2s ease-in, color 0.2s ease-in;
  z-index: 1;
}

.clear_icon {
  @include effects.halo();
  align-self: center;
  color: theme.$primary;
  cursor: pointer;
  flex-shrink: 0;
  justify-self: center;
  position: relative;
  transition: color 0.2s ease-in, opacity 0.2s ease-in;
  z-index: 1;

  &.clear_icon_hidden {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
  }

  // Enhanced hover and focus states
  &:hover:not(.dark):not(.clear_icon_hidden) {
    color: theme.$crimson;
  }

  &:focus-visible {
    outline: 2px solid rgba(theme.$primary-rgb, 0.6);
    outline-offset: 2px;
  }
}

.chevron_icon_rotate {
  transform: rotate(180deg);
  transition: transform 0.2s ease-in;
}

.tags_wrapper {
  align-items: center;
  align-self: center;
  display: flex;
  flex: 1;
  gap: tokens.$space-2;
  min-width: 0;
  overflow: hidden;
  padding: tokens.$space-1 0 tokens.$space-1 tokens.$space-2;
}

.tag_count {
  color: theme.$gray-600;
  flex-shrink: 0;
  font-size: 0.875rem;
  font-weight: 500;
  padding: tokens.$space-1 tokens.$space-2;
  white-space: nowrap;
}

@each $size in $sizes {
  .#{$size} {
    .value {
      @extend %text-#{$size};
    }

    .chevron_icon {
      @extend %icon-#{$size};
    }

    .clear_icon {
      @extend %icon-#{$size};
    }
  }
}

.not_selected {
  color: theme.$gray-500;
  font-style: normal;
  opacity: 0.7;
}
