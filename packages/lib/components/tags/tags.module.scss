@use '@design/core.scss';
@use '@design/list.scss';
@use '@design/theme.scss';
@use '@design/animate.scss';
@use '@design/position.scss';
@use '@design/tokens.scss';
@use '@design/border.scss';
@use '@design/hybrid-theme.scss' as hybrid;
@use 'sass:map';

$sizes: (sm, md, lg);

// Heights in rem to match rem-based padding and ensure proper scaling
// Calculated to accommodate: vertical padding + line-height + icon
$tag-heights: (
  sm: 1.625rem,
  // ~26px at 16px base, accommodates 0.25rem padding + text + icon
  md: 1.875rem,
  // ~30px at 16px base, accommodates 0.5rem padding + text + icon
  lg: 2.125rem, // ~34px at 16px base, accommodates 0.75rem padding + text + icon
);

// Size-specific spacing maps for consistent scaling
$tag-padding-vertical: (
  sm: tokens.$space-1,
  md: tokens.$space-2,
  lg: tokens.$space-3,
);

$tag-padding-horizontal: (
  sm: tokens.$space-2,
  md: tokens.$space-3,
  lg: tokens.$space-4,
);

$tag-margin: (
  sm: tokens.$space-1,
  md: tokens.$space-2,
  lg: tokens.$space-3,
);

$tag-icon-gap: (
  sm: tokens.$space-1,
  md: tokens.$space-1,
  lg: tokens.$space-2,
);

.tags_wrapper {
  &.tags_rtl {
    direction: rtl;
  }

  &.tags_disabled {
    @include hybrid.state-disabled();
  }

  &.tags_wrap {
    @extend %list-wrap;
  }

  &:not(.tags_wrap) {
    @extend %list-horizontal-left;
  }
}

.tag {
  // CSS properties before animation mixins to comply with Sass mixed-decls
  justify-items: center;
  max-width: calc(var(--width) + 1rem);
  min-width: 40px;
  transform: scale(1);
  user-select: none;
  visibility: visible;
  @include hybrid.smooth-transition(opacity, visibility);
  @include hybrid.stagger-children($max-items: 20, $delay-step: 0.05s);

  @media (prefers-reduced-motion: reduce) {
    animation: none;
  }

  &:not(.disabled):not(.readonly) {
    display: grid;
  }

  &.disabled,
  &.readonly {
    @extend %center;
  }

  &.disabled {
    pointer-events: none;
  }
}

.style_fill {
  @extend %border-radius;

  &.dark {
    background: rgba(theme.$primary-rgb, 1);
    color: theme.$white;
  }

  &:not(.dark) {
    background: rgba(theme.$primary-rgb, 1);
    color: theme.$white;
  }
}

.style_default {
  &:not(.dark):not(.readonly) {
    @extend %border;
    @extend %shadow-inset-small;
  }

  &.dark {
    @extend %border-radius;
    @extend %shadow-inset;
    background-color: theme.$dark-control-bg;
    color: theme.$white;
  }
}

.accent_rounded {
  @extend %border-radius-high;
}

.readonly {
  @extend %border-radius;
  background: theme.$primary;
  color: theme.$white;
}

.marked_for_removal {
  animation-name: fade-out;
  max-width: var(--width);
  transform: scale(0.98);
  visibility: hidden;

  @media (prefers-reduced-motion: reduce) {
    animation: none;
    opacity: 0;
  }
}

@each $size in $sizes {
  .tag {
    $ico-size: var(--rc-icon-size-#{$size});
    $icon-gap: map.get($tag-icon-gap, $size);
    $padding-vertical: map.get($tag-padding-vertical, $size);
    $padding-horizontal: map.get($tag-padding-horizontal, $size);
    $margin: map.get($tag-margin, $size);

    align-items: center;
    display: grid;
    justify-items: center;

    &.#{$size} {
      column-gap: $icon-gap;
      grid-template-columns: calc(var(--width) - $ico-size - $icon-gap) $ico-size;
      // Use min-height instead of height to allow content to determine size
      // Custom tag-height prop can override with pixel value if needed
      min-height: var(--tag-height, map.get($tag-heights, $size));
      margin: $margin;
      padding: $padding-vertical $padding-horizontal;
    }
  }

  .#{$size} {
    .icon {
      @extend %icon-#{$size};
    }

    .name {
      @extend %font-#{$size};
    }
  }
}

.icon {
  align-self: center;
  border-radius: 50%;
  cursor: pointer;
  display: block;
  justify-self: flex-end;

  &.icon_editable {
    visibility: visible;
  }

  &:not(.icon_editable) {
    visibility: hidden;
    width: 0;
  }

  &:hover::after {
    @include position.position-abs('center center');
    border-radius: 50%;
    content: '';
    display: block;
    height: 110%;
    width: 110%;
    z-index: -1;
  }
}

.icon_fill {
  &:hover::after {
    background: rgba(theme.$white, 1);
  }

  &:hover {
    color: theme.$primary;
  }
}

.icon_default {
  &:hover::after {
    background: theme.$primary;
  }

  &:hover {
    color: theme.$white;
  }
}

.tags_input_wrapper {
  // Margin scales with size variants - default to sm spacing
  margin-left: tokens.$space-2;
  position: relative;
}

.name {
  @extend %text-no-wrap;
  display: block;
  text-align: center;
  width: 100%;
}

.name {
  @each $size in $sizes {
    &.name_#{$size} {
      @extend %font-#{$size};
    }
  }
}
